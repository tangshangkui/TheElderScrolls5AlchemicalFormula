<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ä¸Šå¤å·è½´5é‡åˆ¶ç‰ˆæ‰€æœ‰çš„ç‚¼é‡‘é…æ–¹è¡¨å’Œè¯å‰‚æ•ˆæœ</title>

    <!-- å¼•å…¥æ ·å¼ -->
    <link rel="stylesheet" href="jsimgcss/vxe-table/style.css">
    <!-- å¼•å…¥vue -->
    <script src="jsimgcss/vue2.js"></script>
    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="jsimgcss/xe-utils.js"></script>
    <script src="jsimgcss/vxe-table/vxe-table2.js"></script>

    <!--æ‰€æœ‰çš„æ•°æ®éƒ½åœ¨è¿™é‡Œ-->
    <script src="data.js"></script>
    <!-- ç”¨åˆ°äº† vue2 vxe-table2.x  -->
</head>
<body>

<div id="app" style="margin: 10px;">
    <h1 v-if="IsUpdate">æ­£åœ¨æ›´æ–°é…æ–¹æ•°æ®,å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ</h1>


    <div v-if="!IsUpdate">

        <div>
            æ•°æ®æ¥æº:<a @click="openurl('https://en.uesp.net/wiki/Skyrim:Ingredients')"
                    href="javascript:void(0)">uespä¸Šå¤å·è½´5ææ–™æ•°æ®</a> |
            <a @click="openurl('https://steamcommunity.com/sharedfiles/filedetails/?id=1378262872')"
               href="javascript:void(0)">steamç‚¼é‡‘æ•ˆæœè¯´æ˜</a> |
            <a @click="openurl('https://wiki.biligame.com/skyrim/%E7%82%BC%E9%87%91%E6%95%88%E6%9E%9C')"
               href="javascript:void(0)">biligameç‚¼é‡‘æ•ˆæœæ•°æ®</a> |
            <a @click="openurl('https://wiki.biligame.com/skyrim/%E4%B8%8A%E5%8F%A4%E5%8D%B7%E8%BD%B45%E5%A4%A9%E9%99%85:%E8%AF%8D%E6%B1%87%E8%A1%A8/%E6%A4%8D%E7%89%A9%E5%92%8C%E7%82%BC%E9%87%91')"
               href="javascript:void(0)">biligameè¯æ±‡ç¿»è¯‘</a>
        </div>
        å‹¾é€‰ææ–™,ç‚¹å‡»è¡¨æ ¼ä¸‹æ–¹"ç”Ÿæˆé…æ–¹"æŒ‰é’®,å°±å¯ä»¥çœ‹åˆ°å‹¾é€‰çš„ææ–™å¯ä»¥ç”Ÿæˆçš„æ‰€æœ‰é…æ–¹,æ•ˆæœ,ä»·æ ¼<br/>
        ç‚¹å‡»å›¾ç‰‡å¯ä»¥æŸ¥çœ‹å›¾ç‰‡å¤§å›¾<br/>
        èŠ±å›­ä¸ä¸ºç©ºè¡¨ç¤ºå¯ä»¥åœ¨èŠ±å›­ä¸­ç§æ¤,ä½†æ•°å­—å…·ä½“æ„ä¹‰æˆ‘ä¸çŸ¥é“<br/>
        æ”¶è—çš„ææ–™å’Œé…æ–¹ä¼šè‡ªåŠ¨ä¿å­˜åœ¨æœ¬åœ°,ä¸‹æ¬¡å¯åŠ¨çš„æ—¶å€™ä¸ä¼šä¸¢å¤±<br/>
        ç‚¹å‡»ä¸­æ–‡å,è‹±æ–‡åè¡¨å¤´çš„ç­›é€‰æŒ‰é’®å¯ä»¥æœç´¢<br/>
        æ§åˆ¶å° player.additem ä»£ç  æ•°é‡<br/>
        ä»£ç é‡Œé¢çš„xxè¡¨ç¤ºmodåºå·,ä¸åŒç”µè„‘å¯èƒ½ä¸ä¸€æ ·<br/>
        ä¾‹å¦‚ FExxx å¯ä»¥ä» FE001 FE002 å¼€å§‹å°è¯•,xx0059ba ä¸­çš„xx åˆ™ ä» 010059ba 020059ba æ…¢æ…¢å°è¯•<br/>
        <!--
                border//è¾¹æ¡†
                stripe//æ–‘é©¬çº¹,éš”è¡ŒèƒŒæ™¯å˜è‰²
                resizable//å¯æ‹–åŠ¨åˆ—å®½
                //é¼ æ ‡æ‰€åœ¨è¡Œé«˜äº®
                highlight-current-row
                highlight-hover-row
                show-overflow //å†…å®¹æº¢å‡ºæ˜¾ç¤ºçœç•¥å·
                 :scroll-y="{enabled: false}" è‡ªåŠ¨æ¢è¡Œ
        -->
        <vxe-toolbar>
            <template v-slot:buttons>
                <vxe-button @click="$refs.vxeTable1.clearFilter()">æ˜¾ç¤ºå…¨éƒ¨</vxe-button>
                <vxe-button @click="show1">æ˜¾ç¤ºå‹¾é€‰çš„</vxe-button>
                <vxe-button @click="show2">æ˜¾ç¤ºæ”¶è—</vxe-button>
                <vxe-button @click="show3">æ˜¾ç¤ºå¯ä»¥ç§æ¤åœ¨èŠ±å›­çš„</vxe-button>
            </template>

        </vxe-toolbar>
        <vxe-table
                ref="vxeTable1"
                border
                stripe
                resizable
                highlight-current-row
                highlight-hover-row

                height="500"
                :scroll-y="{enabled: false}"
                :data="tableData1">
            <vxe-table-column title="åºå·" field="id" width="70"></vxe-table-column>
            <vxe-table-column field="check" :filters="[{label: 'é€‰ä¸­', value: true}, {label: 'æœªé€‰ä¸­', value: false }]"
                              width="90">
                <template v-slot:header>
                    <vxe-checkbox content="å…¨é€‰" @change="change1"></vxe-checkbox>
                </template>
                <template v-slot="{ row }">
                    <vxe-checkbox v-model="row.check"></vxe-checkbox>
                </template>
            </vxe-table-column>

            <vxe-table-column field="material" title="æ”¶è—"
                              :filters="[{label: 'æ”¶è—', value: true}, {label: 'æœªæ”¶è—', value: false }]" width="90">
                <template v-slot="{ row }">
                    <vxe-switch @change="userMaterial(row.id)" v-model="row.material" size="medium" open-label="æ˜¯"
                                close-label="å¦"></vxe-switch>
                </template>
            </vxe-table-column>

            <vxe-table-column field="img" title="å›¾ç‰‡" width="80">
                <template v-slot="{ row }">
                    <img class="pointer" :src="row.img" style="width: 60px;" @click="bigImg(row.img)"/>
                </template>
            </vxe-table-column>
            <vxe-table-column field="name" title="è‹±æ–‡å" width="150" :filters="[{ data: '' }]" :filter-method="strSearch">
                <template v-slot:filter="{ $panel, column }">
                    <!--ç­›é€‰è¾“å…¥æ¡†,å› ä¸ºfiltersæ˜¯ä¸€ä¸ªæ•°ç»„,æ‰€ä»¥ç”¨v-for-->
                    <!--@change="$panel.changeOption($event, !!option.data, option)ç”¨äºåˆ‡æ¢ç­›é€‰æŒ‰é’®çŠ¶æ€-->
                    <!--å®é™…æ‰§è¡Œç­›é€‰çš„å‡½æ•°æ˜¯ strSearch-->
                    <template v-for="(option, index) in column.filters" :filter-method="nameSearch">
                        <vxe-input placeholder="è¯·è¾“å…¥å…³é”®å­—æœç´¢"
                                   :key="index" v-model="option.data"
                                   @keyup.enter.native="$panel.confirmFilter()"
                                   @change="$panel.changeOption($event, !!option.data, option);"></vxe-input>
                    </template>
                </template>
            </vxe-table-column>


            <vxe-table-column field="name_zh" title="ä¸­æ–‡å" width="150" :filters="[{ data: '' }]"
                              :filter-method="strSearch">
                <template v-slot:filter="{ $panel, column }">
                    <!--ç­›é€‰è¾“å…¥æ¡†,å› ä¸ºfiltersæ˜¯ä¸€ä¸ªæ•°ç»„,æ‰€ä»¥ç”¨v-for-->
                    <!--@change="$panel.changeOption($event, !!option.data, option)ç”¨äºåˆ‡æ¢ç­›é€‰æŒ‰é’®çŠ¶æ€-->
                    <!--å®é™…æ‰§è¡Œç­›é€‰çš„å‡½æ•°æ˜¯ strSearch-->
                    <template v-for="(option, index) in column.filters" :filter-method="nameSearch">
                        <vxe-input placeholder="è¯·è¾“å…¥å…³é”®å­—æœç´¢"
                                   :key="index" v-model="option.data"
                                   @keyup.enter.native="$panel.confirmFilter()"
                                   @change="$panel.changeOption($event, !!option.data, option);"></vxe-input>
                    </template>
                </template>
            </vxe-table-column>
            <vxe-table-column field="code" title="ä»£ç " width="100"></vxe-table-column>

            <vxe-table-column field="html1" title="æ•ˆæœ1" width="120"></vxe-table-column>
            <vxe-table-column field="html2" title="æ•ˆæœ2" width="120"></vxe-table-column>
            <vxe-table-column field="html3" title="æ•ˆæœ3" width="120"></vxe-table-column>
            <vxe-table-column field="html4" title="æ•ˆæœ4" width="120"></vxe-table-column>

            <vxe-table-column field="price" title="ä»·æ ¼" width="60"></vxe-table-column>
            <vxe-table-column field="store" title="å•†åº—" width="100"></vxe-table-column>
            <vxe-table-column field="garden" title="èŠ±å›­" width="100"
                              :filters="[{label: 'éç©º', value: '1'},{label: 'ç©ºç™½', value: '2'}]"
                              :filter-method="strSearchNotEmpty"></vxe-table-column>
        </vxe-table>

        <!--å¼¹çª— æ˜¾ç¤ºå¤§å›¾ -->
        <vxe-modal v-model="showImgBig" width="600" show-footer>
            <template v-slot>
                <img :src="showImgBigSrc" style="width: 500px"/>
            </template>
        </vxe-modal>

        <!--==================================================-->
        <div style="margin-top: 20px">
            <vxe-button status="primary" content="å‹¾é€‰ææ–™åç‚¹å‡»è¿™é‡Œè®¡ç®—é…æ–¹" @click="calculateRecipe"></vxe-button>
        </div>
        <h3><vxe-switch  v-model="showTable2" size="medium" open-label="æ˜¾ç¤ºç­›é€‰" close-label="å…³é—­ç­›é€‰"></vxe-switch>ä¸€å…±{{recipeKeys.length}}ä¸ªé…æ–¹,ä¸‹é¢æ˜¯æ‰€æœ‰é…æ–¹çš„æ•ˆæœåˆ—è¡¨,å‹¾é€‰æ•ˆæœå¯ä»¥ç­›é€‰é…æ–¹</h3>

        <vxe-table
                v-if="showTable2"
                ref="vxeTable2"
                border
                stripe
                resizable
                highlight-current-row
                highlight-hover-row

                height="300"
                :scroll-y="{enabled: false}"
                :data="tableData2">
            <vxe-table-column title="åºå·" field="id" width="70"></vxe-table-column>
            <vxe-table-column field="check" width="90">
                <template v-slot:header>
                    <vxe-checkbox content="ç­›é€‰" @change="change2"></vxe-checkbox>
                </template>
                <template v-slot="{ row }">
                    <vxe-checkbox v-model="row.check"></vxe-checkbox>
                </template>
            </vxe-table-column>
            <vxe-table-column field="name" title="æ•ˆæœå" width="200"></vxe-table-column>
            <vxe-table-column field="price" title="ä»·æ ¼" width="200" sortable></vxe-table-column>
            <vxe-table-column field="zh1" title="ä¸­æ–‡æ•ˆæœ" width="200"></vxe-table-column>
            <vxe-table-column field="num" title="é…æ–¹æ•°" width="100"></vxe-table-column>
            <vxe-table-column field="zh" title="æ•ˆæœè§£é‡Š" width="500"></vxe-table-column>

        </vxe-table>

        <h3 v-if="showTable2">ä¸‹é¢æ˜¯é…æ–¹æ•°æ®,ç‚¹å‡»æ”¶è—å¯ä»¥ä¿å­˜é…æ–¹,é…æ–¹æ•°{{tableData3.length}}</h3>
        <vxe-toolbar>
            <template v-slot:buttons>
                <vxe-button v-if="showTable2" status="primary" @click="updateTable3">æ ¹æ®ç­›é€‰é‡æ–°è®¡ç®—é…æ–¹</vxe-button>
                <vxe-button  @click="show4">æ˜¾ç¤ºå…¨éƒ¨</vxe-button>
                <vxe-button @click="show5">æ˜¾ç¤ºæ”¶è—</vxe-button>
            </template>

        </vxe-toolbar>
        ä»·æ ¼æ¯”ä¾‹,ä¾‹å¦‚æ˜¾ç¤ºä»·æ ¼ä¸º100,è€Œä½ å”®å–çš„ä»·æ ¼æ˜¯10,é‚£ä¹ˆè¾“å…¥0.1 æ˜¾ç¤ºçš„ä»·æ ¼å°±ä¼šæ¥è¿‘ä½ çš„å”®å–ä»·æ ¼
        <vxe-input v-model="config.valueBL" placeholder="è¾“å…¥ä»·æ ¼æ¯”ä¾‹" type="float" @change="writeConfig" ></vxe-input>
        <vxe-table
                ref="vxeTable3"
                border
                stripe
                resizable
                highlight-current-row
                highlight-hover-row

                height="600"
                :scroll-y="{enabled: true}"
                :tooltip-config="{showAll: true, contentMethod: showTooltipMethod}"
                :data="tableData3">
            <vxe-table-column title="åºå·" field="id" width="70"></vxe-table-column>
            <vxe-table-column field="check" width="90" title="æ”¶è—">
                <template v-slot="{ row }">
                    <vxe-checkbox v-model="row.userRecipe" @change="change3(row)"></vxe-checkbox>
                </template>
            </vxe-table-column>
            <vxe-table-column field="price" title="ä»·æ ¼" width="50" sortable>

                <template v-slot="{ row }">
                   {{ Math.floor(row.price * config.valueBL) }}
                </template>
            </vxe-table-column>
            <vxe-table-column field="effect" title="é…æ–¹æ•ˆæœ" width="300"></vxe-table-column>
            <vxe-table-column field="effectL" title="æ•ˆæœæ•°" width="50" sortable></vxe-table-column>

            <vxe-table-column field="p1" title="é…æ–¹1" width="300"></vxe-table-column>
            <vxe-table-column field="p2" title="é…æ–¹2" width="300"></vxe-table-column>
            <vxe-table-column field="p3" title="é…æ–¹3" width="300"></vxe-table-column>

            <vxe-table-column field="maxV" title="ä»·æ ¼å€ç‡" width="50" sortable></vxe-table-column>
            <vxe-table-column field="maxM" title="æ•ˆæœå€ç‡" width="50" sortable></vxe-table-column>
            <vxe-table-column field="maxD" title="ç­‰å¾…æ—¶é—´å€ç‡" width="50" sortable></vxe-table-column>

        </vxe-table>


    </div>

</div>

</body>
<script type="text/javascript">
    const G_fs = require("fs");

    //æ‰€æœ‰é…æ–¹
    var G_recipe = {
        // "0_1": {
        //     "price": 0.3, //ä»·æ ¼
        //     "effect": [
        //         {'name': 'æ•ˆæœè‹±æ–‡å', 'v': 'ä»·æ ¼å€ç‡', 'm': 'æ•ˆæœå€ç‡', "d": 'ç­‰å¾…æ—¶é—´å€ç‡'}
        //     ],
        // }
    };
    var G_this;
    var app = new Vue({
        el: '#app',
        data: {
            showTable2:true,
            recipeLength: 0,//é…æ–¹æ€»æ•°,åªåœ¨æ›´æ–°çš„æ—¶å€™æœ‰æ•ˆ
            IsUpdate: false,
            showUserOnly1: false, //åªæ˜¾ç¤ºç”¨æˆ·æ”¶è—çš„é…æ–¹
            tableData1: [],//è¡¨æ ¼1æ•°æ®
            tableData2: [],//è¡¨æ ¼2æ•°æ®
            tableData3: [],//è¡¨æ ¼2æ•°æ®
            recipeKeys: [],//æ ¹æ®å‹¾é€‰è®¡ç®—å‡ºæ¥çš„æ‰€æœ‰é…æ–¹çš„key (å°±æ˜¯ G_recipe çš„key)
            recipeTypes: {},//æ‰€æœ‰çš„æ•ˆæœ [key]:æ•°é‡ (G_Effect çš„ key)
            config: {
                "material": [], //æ”¶è—çš„ææ–™
                "recipe": [], //æ”¶è—çš„é…æ–¹,[[é…æ–™1,é…æ–™2]]
                "valueBL": 1, //ä»·æ ¼æ¯”ä¾‹
            },
            configRecipe: {},//[key]:[é…æ–™1,é…æ–™2] , key ä¸º (å°±æ˜¯ G_recipe çš„key)
            showImgBig: false,//å¼¹å‡ºçª—å£æ˜¾ç¤ºå¤§å›¾
            showImgBigSrc: '',
            data_index: {}, //G_data [name]:index ç´¢å¼•
        },
        created: function () {
            G_this = this;
            for (var i = 0; i < G_data.length; i++) {
                var k = G_data[i].name;
                G_data[i].check = false; //æ˜¯å¦é€‰ä¸­
                G_data[i].material = false;//ç”¨æˆ·æ”¶è—
                G_data[i].id = i;//ç”¨æˆ·æ”¶è—
                G_data[i].html1 = this.getEffectHtml(G_data[i].e1, G_data[i].m1, G_data[i].v1, G_data[i].d1);
                G_data[i].html2 = this.getEffectHtml(G_data[i].e2, G_data[i].m2, G_data[i].v2, G_data[i].d2);
                G_data[i].html3 = this.getEffectHtml(G_data[i].e3, G_data[i].m3, G_data[i].v3, G_data[i].d3);
                G_data[i].html4 = this.getEffectHtml(G_data[i].e4, G_data[i].m4, G_data[i].v4, G_data[i].d4);

                this.data_index[k] = i;
            }
            var c = G_fs.readFileSync('config.json', "utf-8");
            //è¯»å–ç”¨æˆ· æ”¶è—çš„ææ–™å’Œé…æ–¹
            this.config = JSON.parse(c);
            if (this.config.material.length > 0) {
                this.showUserOnly = true;
                for (var i = 0; i < this.config.material.length; i++) {
                    var k = this.config.material[i];
                    G_data[this.data_index[k]].material = true;
                }
            }
            this.tableData1 = G_data;

            if (G_fs.existsSync('recipeCache.json')) {
                G_recipe = JSON.parse(G_fs.readFileSync('recipeCache.json', 'utf-8'));
                this.updateConfigRecipe();
            } else {
                this.IsUpdate = true;
                setTimeout('G_this.updateRecipe();', 1000);
            }
        },
        methods: {
            //è¡¨æ ¼3 æ˜¾ç¤ºæç¤º
            showTooltipMethod ({ type, column, row, items, _columnIndex }) {
                const { property } = column //columnçš„ fieldå±æ€§
                if(property != 'p1' && property != 'p2' && property != 'p3'){
                    //ä¸æ˜¾ç¤ºæç¤º
                    return false
                }
                if(property == 'p3' && row.p3id < 0){
                    return false
                }
                var id = 0 ;
                if(property == 'p1'){
                    id = row.p1id;
                }
                if(property == 'p2'){
                    id = row.p2id;
                }
                if(property == 'p3'){
                    id = row.p3id;
                }
                var str = "åç§°:" + G_data[id].name_zh +"\n";
                str += "æ•ˆæœ:"+G_data[id].html1+"\n";
                str += G_data[id].html2+"\n";
                str += G_data[id].html3+"\n";
                str += G_data[id].html4+"\n";
                str += "ä»·æ ¼:"+G_data[id].price+"\n";
                str += "å•†åº—:"+G_data[id].store+"\n";
                str += "èŠ±å›­:"+G_data[id].garden+"\n";
                return str;
            },
            //æ˜¾ç¤ºå‹¾é€‰
            show1: function () {
                const xTable = this.$refs.vxeTable1
                xTable.clearFilter() //æ¸…ç†æŸ¥è¯¢æ¡ä»¶
                const column = xTable.getColumnByField('check')
                // ä¿®æ”¹ç¬¬1ä¸ªé€‰é¡¹ä¸ºå‹¾é€‰çŠ¶æ€
                column.filters[0].checked = true
                // ä¿®æ”¹æ¡ä»¶ä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ updateData å¤„ç†è¡¨æ ¼æ•°æ®
                xTable.updateData()
            },
            //æ˜¾ç¤ºæ”¶è—
            show2: function () {
                const xTable = this.$refs.vxeTable1
                xTable.clearFilter() //æ¸…ç†æŸ¥è¯¢æ¡ä»¶
                const column = xTable.getColumnByField('material')
                // ä¿®æ”¹ç¬¬1ä¸ªé€‰é¡¹ä¸ºå‹¾é€‰çŠ¶æ€
                column.filters[0].checked = true
                // ä¿®æ”¹æ¡ä»¶ä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ updateData å¤„ç†è¡¨æ ¼æ•°æ®
                xTable.updateData()
            },
            //æ˜¾ç¤ºå¯ä»¥ç§æ¤èŠ±å›­çš„
            show3: function () {
                const xTable = this.$refs.vxeTable1
                xTable.clearFilter() //æ¸…ç†æŸ¥è¯¢æ¡ä»¶
                const column = xTable.getColumnByField('garden')
                // ä¿®æ”¹ç¬¬1ä¸ªé€‰é¡¹ä¸ºå‹¾é€‰çŠ¶æ€
                column.filters[0].checked = true
                // ä¿®æ”¹æ¡ä»¶ä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ updateData å¤„ç†è¡¨æ ¼æ•°æ®
                xTable.updateData()
            },
            //è¡¨æ ¼3 æ˜¾ç¤ºå…¨éƒ¨
            show4: function () {
                for (let i = 0; i < this.tableData2.length; i++) {
                    this.tableData2[i].check = true;
                }
                this.updateTable3();
            },
            //æ˜¾ç¤ºå‹¾é€‰çš„é…æ–¹
            calculateRecipe: function () {
                this.recipeKeys = [];//æ‰€æœ‰é…æ–¹çš„key(å°±æ˜¯ G_recipe çš„key)
                var ids = [];
                for (var i = 0; i < this.tableData1.length; i++) {
                    if (this.tableData1[i].check) {
                        ids.push(this.tableData1[i].id);
                    }
                }
                if (ids.length < 3) {
                    this.$XModal.alert('è¯·è‡³å°‘é€‰æ‹©3ç§ææ–™', 'æç¤º');
                    return;
                }
                for (i = 0; i < (ids.length - 2); i++) {
                    for (var j = i + 1; j < (ids.length - 1); j++) {
                        var key = "" + ids[i] + '_' + ids[j]
                        if (G_recipe.hasOwnProperty(key)) {
                            this.recipeKeys.push(key);
                        }
                        for (var k = j + 1; k < ids.length; k++) {
                            var key2 = "" + ids[i] + "_" + ids[j] + '_' + ids[k]
                            if (G_recipe.hasOwnProperty(key2)) {
                                this.recipeKeys.push(key2);
                            }
                        }
                    }
                }
                if (this.recipeKeys.length == 0) {
                    this.$XModal.alert('æ²¡æœ‰åŒ¹é…çš„é…æ–¹', 'æç¤º');
                    return;
                }
                this.updateRecipeTypes();
                this.updateTable2();
                this.updateTable3();
            },
            updateRecipeTypes() {
                //æ›´æ–° recipeTypes
                var recipeTypes = {};
                for (var i = 0; i < this.recipeKeys.length; i++) {
                    var key = this.recipeKeys[i];
                    var effect = G_recipe[key].effect;
                    for (var j = 0; j < effect.length; j++) {
                        var name = effect[j].name
                        if (recipeTypes.hasOwnProperty(name)) {
                            recipeTypes[name]++;
                        } else {
                            recipeTypes[name] = 1;
                        }
                    }
                }
                this.recipeTypes = recipeTypes;
            },
            updateTable2: function () {
                //å‹¾é€‰ è‹±æ–‡å ä¸­æ–‡å é…æ–¹æ•° è§£é‡Š
                var tableData2 = [];
                var id = 0;
                for (let name in this.recipeTypes) {
                    id++;
                    tableData2.push({
                        id: id,
                        check: true,
                        name: name,
                        zh1: G_Effect[name].zh1,
                        num: this.recipeTypes[name],
                        zh: G_Effect[name].zh,
                        price: G_Effect[name].price,
                    });
                }

                this.tableData2 = tableData2;
            },
            updateConfigRecipe: function () {
                var Recipe = this.config.recipe; //ç”¨æˆ·æ”¶è—çš„é…æ–¹
                if (Recipe.length < 1) {
                    return;
                }
                for (var i = 0; i < Recipe.length; i++) {
                    var Rec = Recipe[i];
                    var bool = true;
                    var arr = [];
                    for (var j = 0; j < Rec.length; j++) {
                        if (!this.data_index.hasOwnProperty(Rec[j])) {
                            bool = false;
                            break;
                        }
                        arr.push(this.data_index[Rec[j]])
                    }
                    if (bool) {
                        arr.sort(function (a, b) {
                            return a - b;
                        })
                        if (arr.length == 3) {
                            var key = "" + arr[0] + "_" + arr[1] + "_" + arr[2];
                        } else {
                            var key = "" + arr[0] + "_" + arr[1];
                        }
                        var arr2 = [];
                        for (var j = 0; j < arr.length; j++) {
                            var name = G_data[arr[j]].name;
                            arr2.push(name);
                        }

                        if (G_recipe.hasOwnProperty(key)) {
                            this.configRecipe[key] = arr2;
                        }
                    }
                }
            },
            updateTable3: function () {
                var tableData3 = [];
                var checkKey = {};
                for (var i = 0; i < this.tableData2.length; i++) {
                    if (this.tableData2[i].check) {
                        checkKey[this.tableData2[i].name] = true;
                    }
                }
                var id = 0;
                for (var i = 0; i < this.recipeKeys.length; i++) {
                    var key = this.recipeKeys[i];
                    var effect = G_recipe[key].effect;
                    var bool = false;
                    for (var j = 0; j < effect.length; j++) {
                        if (checkKey.hasOwnProperty(effect[j].name)) {
                            bool = true;
                            break;
                        }
                    }
                    //{"1_3":{"price":261,"effect":[{"name":"Invisibility","v":1,"m":1,"d":1}],"effectL":1}
                    if (bool) {
                        id++;
                        tableData3.push(
                            this.getTable3DataOne(key, id)
                        )
                    }
                }
                this.tableData3 = tableData3;
            },
            //æ˜¾ç¤ºæ”¶è—
            show5: function () {
                // configRecipe: {},//[key]:[é…æ–™1,é…æ–™2] , key ä¸º (å°±æ˜¯ G_recipe çš„key)
                var tableData = [];
                var id = 0;
                for (var key in this.configRecipe) {
                    id++;
                    tableData.push(
                        this.getTable3DataOne(key, id)
                    );
                }
                this.tableData3 = tableData;
            },
            getTable3DataOne:function (key,id){
                var nameArr=[];
                var ids = key.split("_");
                for (var j = 0; j < ids.length; j++) {
                    ids[j] = parseInt(ids[j]);
                    nameArr.push(G_data[ids[j]].name)
                }
                var effectStr = "";
                var maxM = 0;
                var maxV = 0;
                var maxD = 0;

                var effect = G_recipe[key].effect;
                for (var j = 0; j < effect.length; j++) {
                    var effect1 = effect[j];
                    var str = G_Effect[effect1.name].zh1;
                    if (effect1.m != 1) {
                        str += " " + effect1.m + "ğŸ”¥";
                    }
                    if (effect1.v != 1) {
                        str += " " + effect1.v + "ğŸ’°";
                    }
                    if (effect1.d != 1) {
                        str += " " + effect1.d + "âŒ›";
                    }
                    maxM = Math.max(maxM, effect1.m);
                    maxV = Math.max(maxV, effect1.v);
                    maxD = Math.max(maxD, effect1.d);

                    effectStr = effectStr + str + ",";

                }
               return {
                   id: id,
                   key: key,
                   userRecipe: this.configRecipe.hasOwnProperty(key) ? true : false,
                   price: G_recipe[key].price,
                   maxM: maxM,
                   maxV: maxV,
                   maxD: maxD,
                   effectL: G_recipe[key].effectL, //é…æ–¹æ•ˆæœæ•°
                   p1: G_data[ids[0]].name_zh + "[" + G_data[ids[0]].code + "]",//é…æ–¹1
                   p2: G_data[ids[1]].name_zh + "[" + G_data[ids[1]].code + "]",//é…æ–¹2
                   p3: ids.length > 2 ? G_data[ids[2]].name_zh + "[" + G_data[ids[2]].code + "]" : "",

                   p1id:ids[0],
                   p2id:ids[1],
                   p3id:ids.length > 2 ? ids[2] : -1,

                   nameArr: nameArr,
                   effect: effectStr,
               };
            },
            //æ”¶è—
            userMaterial: function (id) {
                var name = G_data[id].name;
                var bool = G_data[id].material;
                var index = this.config.material.indexOf(name);
                if (bool) {
                    if (index == -1) {
                        this.config.material.push(name);
                    }
                } else {
                    if (index != -1) {
                        this.config.material.splice(index, 1);
                    }
                }
                this.writeConfig();
            },
            writeConfig: function () {
                var config = JSON.stringify(this.config);
                G_fs.writeFileSync('config.json', config);
            },
            //é»˜è®¤æµè§ˆå™¨æ‰“å¼€url
            openurl: function (url) {
                nw.Shell.openExternal(url);
            },
            //ç¬¬ä¸€ä¸ªè¡¨æ ¼å…¨é€‰
            change1: function (checked) {
                var c = checked.value;
                //è·å–ç­›é€‰ç»“æœ this.$refs.vxeTable1.getTableData().visibleData
                var data = this.$refs.vxeTable1.getTableData().visibleData;
                for (var i = 0; i < data.length; i++) {
                    var id = data[i].id;
                    G_data[id].check = c;
                }
            },
            //ç¬¬äºŒä¸ªè¡¨æ ¼å…¨é€‰
            change2: function (checked) {
                var c = checked.value;
                for (var i = 0; i < this.tableData2.length; i++) {
                    this.tableData2[i].check = c;
                }
            },
            //æ”¶è—æŒ‰é’®è¢«ç‚¹å‡»
            change3:function (row){
                var bool = row.userRecipe;
                if (bool) {
                    if(!this.configRecipe.hasOwnProperty(row.key)){
                        this.configRecipe[row.key] = row.nameArr;
                    }
                }else{
                    if(this.configRecipe.hasOwnProperty(row.key)){
                        delete this.configRecipe[row.key];
                    }
                }
                var recipe = [];
                for(var key in this.configRecipe){
                    recipe.push(this.configRecipe[key]);
                }
                this.config.recipe = recipe;
                this.writeConfig();
            },
            //æœç´¢ç­›é€‰
            strSearch: function (v) {
                //è¢«æœç´¢çš„å­—ç¬¦ä¸²
                var str = v.cellValue.toLowerCase();
                // v.row å½“å‰è¡Œæ•°æ®
                // ç­›é€‰æ¡†ä¸­è¾“å…¥çš„å…³é”®å­—
                var key = v.option.data.toLowerCase();
                //æŸ¥æ‰¾å­—ç¬¦ä¸²
                if (str.indexOf(key) >= 0) {
                    return true;
                } else {
                    return false;
                }
            },
            strSearchNotEmpty: function (v) {
                var str = v.cellValue;
                var key = v.value;
                if (key == '1') {
                    if (str != '') {
                        return true;
                    } else {
                        return false;
                    }
                }
                return true;
            },
            bigImg: function (src) {
                this.showImgBigSrc = src;
                this.showImgBig = true;
            },
            //ğŸ”¥ âŒ› ğŸ’° ç”Ÿæˆ æ•ˆæœhtmlæ•°æ®(å‚æ•°æ˜¯ G_dataä¸­çš„ e1,m1,v1,d1)
            getEffectHtml(e, m, v, d) {
                // "e": "Weakness to Frost", //æ•ˆæœ1
                // "m": 1, //æ•ˆæœå€ç‡
                // "v": 1, //ä»·å€¼å€ç‡
                // "d": 1, //ç­‰å¾…æ—¶é—´å€ç‡
                var html = G_Effect[e].zh1;
                if (m != 1) {
                    html += " " + m + "ğŸ”¥";
                }
                if (v != 1) {
                    html += " " + v + "ğŸ’°";
                }
                if (d != 1) {
                    html += " " + d + "âŒ›";
                }
                return html;
            },
            //=======================é‡æ–°è®¡ç®—æ‰€æœ‰é…æ–¹====================
            updateRecipe: function () {
                G_recipe = {};
                var length = G_data.length
                for (var i = 0; i < (length - 2); i++) {
                    for (var j = i + 1; j < (length - 1); j++) {
                        for (var k = j + 1; k < length; k++) {
                            this.get_recipe(i, j, k)
                        }
                    }
                }
                G_recipe['_length'] = this.recipeLength
                G_fs.writeFileSync('recipeCache.json', JSON.stringify(G_recipe));
                this.updateConfigRecipe();
                this.IsUpdate = false;
            },
            //m1 m2 m3 æ˜¯ææ–™id
            get_recipe: function (m1, m2, m3) {
                var arr = [parseInt(m1), parseInt(m2), parseInt(m3)];
                //ä»å°åˆ°å¤§æ’åº
                arr.sort(function (a, b) {
                    return a - b;
                })
                var k = "" + arr[0] + "_" + arr[1] + "_" + arr[2];
                if (G_recipe.hasOwnProperty(k)) {
                    return;
                }
                //======ä¸¤ç§è¯å‰‚çš„æ•ˆæœ =========
                var reArr = [
                    {
                        k: "" + arr[0] + "_" + arr[1],
                        v: this.get_recipe2(arr[0], arr[1]).effect
                    },
                    {
                        k: "" + arr[0] + "_" + arr[2],
                        v: this.get_recipe2(arr[0], arr[2]).effect
                    },
                    {
                        k: "" + arr[1] + "_" + arr[2],
                        v: this.get_recipe2(arr[1], arr[2]).effect
                    }
                ];
                var nn = 0;
                if (reArr[0].v.length > 0) {
                    nn++;
                }
                if (reArr[1].v.length > 0) {
                    nn++;
                }
                if (reArr[2].v.length > 0) {
                    nn++;
                }
                if (nn < 2) {
                    //å¦‚æœåªæœ‰ä¸€ç§é…ç½®æœ‰æ•ˆæœ,é‚£ä¹ˆä¸‰ç§ç‰©å“ä¸å¯èƒ½æ¯”ä¸¤ç§æ•ˆæœå¥½
                    return;
                }

                var effects = [];
                for (var i = 0; i < reArr.length; i++) {
                    //æŠŠæ‰€æœ‰æ•ˆæœåˆå¹¶åˆ°ä¸€ä¸ªæ•°ç»„ä¸­
                    effects.push(...reArr[i].v)
                }
                var e_kyes = {};
                var effects1 = [];
                //æŠŠæ‰€æœ‰æ•ˆæœåˆå¹¶åˆ°ä¸€ä¸ªæ•°ç»„ä¸­
                for (var i = 0; i < effects.length; i++) {
                    if (!e_kyes.hasOwnProperty(effects[i].name)) {
                        e_kyes[effects[i].name] = 1;
                        effects1.push(effects[i])
                    }
                }
                //è®¡ç®— m v d æœ€å¤§å€¼
                for (var i = 0; i < effects1.length; i++) {
                    var m = 0;
                    var v = 0;
                    var d = 0;
                    for (var j = 0; j < effects.length; j++) {
                        if (effects1[i].name == effects[j].name) {
                            m = Math.max(m, effects[j].m);
                            v = Math.max(v, effects[j].v);
                            d = Math.max(d, effects[j].d);
                        }
                    }
                    effects1[i].m = m;
                    effects1[i].v = v;
                    effects1[i].d = d;
                }
                //åˆ¤æ–­æ•ˆæœæ˜¯å¦å’Œä¸¤ç§è¯ç‰©ç›¸åŒ,å¦‚æœåŠ å…¥ç¬¬ä¸‰ç§æˆåˆ†æ•ˆæœ,ä»·æ ¼,æ•ˆæœå€ç‡,ç­‰å¾…æ—¶é—´å€ç‡éƒ½æ²¡æœ‰å¢åŠ ,é‚£ä¹ˆä¸‰ç§æˆåˆ†çš„é…æ–¹æ˜¯æ— æ•ˆçš„
                if (!(this.is_beter(effects1, reArr[0].v) && this.is_beter(effects1, reArr[0].v) && this.is_beter(effects1, reArr[0].v))) {
                    return;
                }
                //è®¡ç®—ä»·æ ¼

                var price = 0;
                for (var i = 0; i < effects1.length; i++) {
                    price = price + G_Effect[effects1[i].name].price * effects1[i].v;
                }
                var k = "" + arr[0] + "_" + arr[1] + "_" + arr[2];
                var re = {
                    "price": price, //ä»·æ ¼
                    "effect": effects1,
                    "effectL": effects1.length,
                }
                this.recipeLength++;
                G_recipe[k] = re;
            },
            //åˆ¤æ–­ e1 æ•ˆæœæ˜¯å¦ æ¯” e2å¥½
            is_beter: function (e1, e2) {
                if (e1.length > e2.length) {
                    return true;
                }
                var bool = false;
                for (var i = 0; i < e1.length; i++) {
                    for (var j = 0; j < e2.length; j++) {
                        if (e1[i].name == e2[j].name) {
                            if (e1[i].m > e2[j].m || e1[i].v > e2[j].v || e1[i].d > e2[j].d) {
                                bool = true;
                            }
                        }
                    }
                }
                return bool;
            },
            //è·å–ä¸¤ç§ææ–™çš„æ•ˆæœ
            get_recipe2: function (m1, m2) {
                //æ‰€æœ‰æ•ˆæœä¸­ ä¸å­˜åœ¨æŸç§æ•ˆæœçš„ä»·æ ¼å¢ç›Š åŒæ—¶æ‹¥æœ‰ å¢åŠ  å’Œ å‡å°‘
                //æ‰€æœ‰æ•ˆæœä¸­ ä¸å­˜åœ¨æŸç§æ•ˆæœçš„ä»·æ ¼å¢ç›Šä¸ç›¸åŒçš„æƒ…å†µ(å³é’ˆå¯¹åŒä¸€ç§æ•ˆæœçš„ä»·æ ¼å¢å¹…,aäº§å“ å’Œ bäº§å“è¦ä¹ˆæ²¡æœ‰å¢å¹… è¦ä¹ˆå¢å¹…ç›¸åŒ)
                //åŒæ ·å¢åŠ å€¼ æ— è®ºæ˜¯2ä¸ªè¿˜æ˜¯3ä¸ªéƒ½å–æœ€å¤§å€¼,ä¾‹å¦‚ (0.3å’Œ0.7) å–0.7,(0.3 0.7 1)å–1
                var k = "" + m1 + "_" + m2;
                if (G_recipe.hasOwnProperty(k)) {
                    return this.deepCopy( G_recipe[k] );
                }
                var re = {
                    "price": 0, //ä»·æ ¼
                    "effect": [
                        // {'name': 'æ•ˆæœè‹±æ–‡å', 'v': 'ä»·æ ¼å€ç‡', 'm': 'æ•ˆæœå€ç‡', "d": 'ç­‰å¾…æ—¶é—´å€ç‡'}
                    ],
                }
                for (var i = 1; i <= 4; i++) {
                    var e1 = G_data[m1]["e" + i];
                    for (var j = 1; j <= 4; j++) {
                        var e2 = G_data[m2]["e" + j];
                        if (e1 == e2) {
                            re["effect"].push({
                                'name': e1,
                                'v': Math.max(G_data[m1]["v" + i], G_data[m2]["v" + j]),
                                'm': Math.max(G_data[m1]["m" + i], G_data[m2]["m" + j]),
                                "d": Math.max(G_data[m1]["d" + i], G_data[m2]["d" + j]),
                            })
                        }
                    }
                }
                //===========è®¡ç®—ä»·æ ¼===================
                if (re.effect.length > 0) {
                    var price = 0;
                    for (var i = 0; i < re.effect.length; i++) {
                        price = price + G_Effect[re.effect[i].name].price * re.effect[i].v;
                    }
                }
                re.price = price;
                if (re.effect.length > 0) {
                    k = "" + m1 + "_" + m2;
                    re.effectL = re.effect.length
                    G_recipe[k] = re;
                    this.recipeLength++;
                }
                return this.deepCopy(re);
            },
            deepCopy: function (obj) {
               return  JSON.parse(JSON.stringify(obj))
            },
        }
    })


</script>
<style scoped>
    .pointer {
        cursor: pointer;
    }
</style>
</html>